generator client {
  provider        = "prisma-client-js"
  output          = "../src/generated/prisma"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  email String  @unique
  id    Int     @id @default(autoincrement())
  name  String?
  posts Post[]
}

model Post {
  authorId  Int?
  content   String?
  id        Int     @id @default(autoincrement())
  published Boolean @default(false)
  title     String
  author    User?   @relation(fields: [authorId], references: [id])
}

model KitchenCategory {
  name     String           @db.VarChar(50)
  isActive Boolean          @default(true) @map("is_active")
  id       String           @id @default(uuid()) @db.Uuid
  products KitchenProduct[]

  @@map("kitchen_categories")
}

model KitchenProduct {
  categoryId  String?          @map("category_id") @db.Uuid
  name        String           @db.VarChar(100)
  description String?
  basePrice   Decimal          @map("base_price") @db.Decimal(10, 2)
  imageUrl    String?          @map("image_url")
  isActive    Boolean          @default(true) @map("is_active")
  createdAt   DateTime         @default(now()) @map("created_at")
  id          String           @id @default(uuid()) @db.Uuid
  category    KitchenCategory? @relation(fields: [categoryId], references: [id])
  recipes     Recipe[]

  @@map("kitchen_products")
}

model Recipe {
  id               String         @id @default(uuid())
  productId        String         @map("product_id") @db.Uuid
  inventoryItemId  String         @map("inventory_item_id") @db.Uuid
  quantityRequired Decimal        @map("quantity_required") @db.Decimal(10, 3)
  applyOn          RecipeScope    @default(ALL) @map("apply_on")
  product          KitchenProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("recipes")
}

model InventoryItem {
  id            String   @id @default(uuid())
  name          String   @db.VarChar(100)
  type          ItemType
  currentStock  Decimal  @default(0) @map("current_stock") @db.Decimal(10, 3)
  unitMeasure   String   @map("unit_measure")
  averageCost   Decimal  @default(0) @map("average_cost") @db.Decimal(10, 2)
  minStockAlert Decimal  @default(5) @map("min_stock_alert") @db.Decimal(10, 3)
  lastUpdated   DateTime @default(now()) @updatedAt @map("last_updated")

  @@map("inventory_items")
}

model InventoryLog {
  id             String       @id @default(uuid())
  itemId         String       @map("item_id") @db.Uuid
  movementType   MovementType @map("movement_type")
  quantityChange Decimal      @map("quantity_change") @db.Decimal(10, 3)
  reason         String?
  createdAt      DateTime     @default(now()) @map("created_at")

  @@map("inventory_logs")
}

model KitchenAsset {
  id            String      @id @default(uuid())
  name          String      @db.VarChar(100)
  totalQuantity Int         @default(0) @map("total_quantity")
  status        AssetStatus @default(OPERATIONAL)
  lastAuditDate DateTime?   @map("last_audit_date") @db.Date
  notes         String?

  @@map("kitchen_assets")
}

model AssetLog {
  id             String   @id @default(uuid())
  assetId        String   @map("asset_id") @db.Uuid
  quantityChange Int      @map("quantity_change")
  reason         String?
  reportedBy     String   @map("reported_by") @db.Uuid
  createdAt      DateTime @default(now()) @map("created_at")

  @@map("asset_logs")
}

model KitchenStaff {
  id         String    @id @default(uuid())
  userId     String    @unique @map("user_id") @db.Uuid
  workerCode String    @unique @map("worker_code") @db.VarChar(10)
  role       StaffRole
  isActive   Boolean   @default(true) @map("is_active")

  @@map("kitchen_staff")
}

model StaffShift {
  id         String    @id @default(uuid())
  staffId    String    @map("staff_id") @db.Uuid
  shiftStart DateTime  @default(now()) @map("shift_start")
  shiftEnd   DateTime? @map("shift_end")
  isPresent  Boolean   @default(true) @map("is_present")

  @@map("staff_shifts")
}

model KdsProductionQueue {
  id               String       @id @default(uuid())
  externalOrderId  String       @map("external_order_id") @db.VarChar(50)
  sourceModule     SourceModule @map("source_module")
  displayLabel     String       @map("display_label") @db.VarChar(50)
  customerName     String       @map("customer_name") @db.VarChar(100)
  serviceMode      ServiceType  @map("service_mode")
  productId        String       @map("product_id") @db.Uuid
  quantity         Int          @default(1)
  preparationNotes String?      @map("preparation_notes")
  status           KdsStatus    @default(PENDING)
  priorityLevel    Int          @default(1) @map("priority_level")
  assignedChefId   String?      @map("assigned_chef_id") @db.Uuid
  assignedWaiterId String?      @map("assigned_waiter_id") @db.Uuid
  createdAt        DateTime     @default(now()) @map("created_at")
  startedAt        DateTime?    @map("started_at")
  finishedAt       DateTime?    @map("finished_at")

  @@index([status])
  @@map("kds_production_queue")
}

enum RecipeScope {
  DINE_IN
  DELIVERY
  TAKEOUT
  PICKUP
  ALL
}

enum ItemType {
  INGREDIENT
  PACKAGING
}

enum MovementType {
  PURCHASE
  SALE
  WASTE
  ADJUSTMENT
  RETURN_RESTOCK
}

enum AssetStatus {
  OPERATIONAL
  UNDER_MAINTENANCE
  DAMAGED
  LOST
}

enum SourceModule {
  AC_MODULE
  DP_MODULE
}

enum ServiceType {
  DINE_IN
  TAKEOUT
  DELIVERY
  PICKUP
}

enum KdsStatus {
  PENDING
  COOKING
  READY
  SERVED
  REJECTED
}

enum StaffRole {
  CHEF
  WAITER
  RUNNER
  HEAD_CHEF
}
